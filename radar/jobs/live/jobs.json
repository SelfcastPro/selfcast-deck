<script>
const PATH = "jobs/live/jobs.json"; // URL eller relativ sti
let DATA = [];
let FILTERED = [];
const readStoreKey = "radar:read:v1"; // stable localStorage key

/* ---------- utilities ---------- */
const esc = s => (s||'').replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;","&gt;":">","\"":"&quot;","'":"&#39;"}[m]));
const fmtDate = (d)=> d ? new Date(d).toLocaleDateString("da-DK") : "";
const toISO = (d)=> d ? (new Date(d)).toISOString() : null;
const now = ()=> new Date().toISOString();

/* stable id logic:
   prefer explicit post_id fields (post_id, id, facebookId), else fallback to hash of facebookUrl + text snippet
*/
function stableId(r){
  if(!r) return '';
  if(r.post_id) return String(r.post_id);
  if(r.id) return String(r.id);
  if(r.facebookId) return String(r.facebookId);
  if(r.facebookUrl && r.user && r.user.id){
    return `${r.facebookUrl}|${r.user.id}|${String((r.text||'').slice(0,80)).replace(/\s+/g,' ')}`;
  }
  return `${r.facebookUrl||''}|${String((r.text||'').slice(0,80)).replace(/\s+/g,' ')}`;
}
</script>
