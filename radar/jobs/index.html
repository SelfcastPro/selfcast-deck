<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Selfcast – Casting Jobs Radar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    body { font-family: sans-serif; background:#111; color:#eee; margin:0; padding:1rem; }
    h1 { margin:0 0 1rem 0; }
    table { width:100%; border-collapse:collapse; margin-top:1rem; }
    th, td { text-align:left; padding:0.5rem; border-bottom:1px solid #333; vertical-align:top; }
    th { background:#222; }
    a { color:#4ea3ff; text-decoration:none; }
    a:hover { text-decoration:underline; }
    .snippet { max-width:600px; white-space:pre-line; }
    .meta { font-size:0.85em; color:#aaa; }
    .fallback { padding:2rem; text-align:center; color:#aaa; }
  </style>
</head>
<body>
  <h1>Selfcast – Casting Jobs Radar</h1>
  <div id="status">Loading…</div>
  <table id="jobs" style="display:none;">
    <thead>
      <tr>
        <th>Title</th>
        <th>Snippet</th>
        <th>Source</th>
        <th>Posted</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <div id="fallback" class="fallback" style="display:none;"></div>

  <script>
    async function loadJobs() {
      try {
        const res = await fetch("live/jobs.json");
        if (!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();

        const table = document.getElementById("jobs");
        const tbody = table.querySelector("tbody");
        const status = document.getElementById("status");
        const fallback = document.getElementById("fallback");

        const lastUpdate = data.updatedAt
          ? new Date(data.updatedAt).toLocaleString()
          : "unknown";

        if (!data.items || data.items.length === 0) {
          status.style.display = "none";
          table.style.display = "none";
          fallback.style.display = "block";
          fallback.textContent = `No casting jobs found — last update: ${lastUpdate}`;
          return;
        }

        status.textContent = `Loaded ${data.items.length} posts · Updated: ${lastUpdate}`;
        tbody.innerHTML = "";

        for (const job of data.items) {
          const tr = document.createElement("tr");

          const tdTitle = document.createElement("td");
          tdTitle.innerHTML = `<a href="${job.url}" target="_blank">${job.title}</a>`;
          tr.appendChild(tdTitle);

          const tdSnippet = document.createElement("td");
          tdSnippet.className = "snippet";
          tdSnippet.textContent = job.summary || "";
          tr.appendChild(tdSnippet);

          const tdSource = document.createElement("td");
          tdSource.textContent = job.source || "";
          tr.appendChild(tdSource);

          const tdDate = document.createElement("td");
          tdDate.className = "meta";
          tdDate.textContent = job.posted_at
            ? new Date(job.posted_at).toLocaleDateString()
            : "";
          tr.appendChild(tdDate);

          tbody.appendChild(tr);
        }

        table.style.display = "table";
        fallback.style.display = "none";
      } catch (err) {
        document.getElementById("status").textContent =
          "Error loading jobs: " + err.message;
      }
    }

    loadJobs();
  </script>
</body>
</html>
