<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Selfcast – Presentation</title>
<style>
  :root{ --bg:#0b0b0b; --fg:#111; --paper:#fff; --muted:#6b7280; --line:#e5e7eb; --accent:#e51c23; --green:#16a34a; }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:#f5f5f5}
  .max{max-width:1100px;margin:0 auto;padding:24px}
  .sheet{background:var(--paper);color:var(--fg);border-radius:18px;padding:28px}
  .bar{display:flex;gap:10px;align-items:center;margin-bottom:12px}
  .btn{display:inline-flex;align-items:center;gap:8px;background:var(--accent);border:none;color:#fff;padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:700}
  .proj-title{font-size:34px;font-weight:900}
  .wordmark{letter-spacing:.18em;font-weight:900;font-size:20px}
  .subtitle{color:#6b7280;font-size:13px;font-weight:700;letter-spacing:.06em}
  .rolegrid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:18px}
  .rolecard{border:1px solid var(--line);border-radius:16px;background:#fff;overflow:hidden}
  .imgwrap{position:relative}
  .imgwrap img{display:block;width:100%;height:240px;object-fit:cover;object-position:top}
  .rolecta{position:absolute;right:10px;bottom:10px;background:var(--accent);color:#fff;text-decoration:none;font-weight:800;border:none;border-radius:10px;padding:6px 10px;font-size:12px}
  .cap{padding:10px 12px}
  .how{background:#ffe8ea;border:1px solid var(--accent);border-radius:14px;padding:12px}
  .how h2{margin:0 0 6px;font-size:18px}
  .how p{margin:6px 0;font-size:14px;line-height:1.45}
  .green{color:#16a34a;font-weight:700}
  @media print{
    @page{size:A4;margin:12mm}
    html,body{background:#fff}
    .sheet{border:none;border-radius:0;padding:0}
    .max{max-width:794px;margin:0 auto;padding:0}
    .bar{display:none !important}
  }
</style>
</head>
<body>
<div class="max">
  <div class="bar">
    <button class="btn" id="btn-print">Download PDF</button>
  </div>
  <div id="app"></div>
</div>

<script>
/*! LZString (decode only, min) */
var LZString=function(){function o(o,r){if(!t[o]){t[o]={};for(var n=0;n<o.length;n++)t[o][o.charAt(n)]=n}return t[o][r]}var r=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",t={},e={decompressFromEncodedURIComponent:function(t){return null==t?"":""==t?null:e._decompress(t.length,32,function(e){return o(n,t.charAt(e))})},_decompress:function(o,t,e){var i,s,p,u,c,a,l,f=[],h=4,d=4,m=3,v="",w=[],A={val:e(0),position:t,index:1};for(i=0;i<3;i+=1)f[i]=i;for(p=0,c=Math.pow(2,2),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=t,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;switch(p){case 0:for(p=0,c=Math.pow(2,8),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=t,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1; l=r(p);break;case 1:for(p=0,c=Math.pow(2,16),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=t,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1; l=r(p);break;case 2:return""}for(f[3]=l,s=l,w.push(l);;){if(A.index>o)return"";for(p=0,c=Math.pow(2,m),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=t,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;switch(l=p){case 0:for(p=0,c=Math.pow(2,8),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=t,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;f[d++]=r(p),l=d-1,h--;break;case 1:for(p=0,c=Math.pow(2,16),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=t,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;f[d++]=r(p),l=d-1,h--;break;case 2:return w.join("")}if(0==h&&(h=Math.pow(2,m),m++),f[l])v=f[l];else{if(l!==d)return null;v=s+s.charAt(0)}w.push(v),f[d++]=s+v.charAt(0),h--,s=v,0==h&&(h=Math.pow(2,m),m++)}}; return e;}();

function qs(k){return new URLSearchParams(location.search).get(k)||"";}
function esc(s){return (s||"").replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]));}
function decodeLegacyBase64(s){
  try{ s=s.replace(/ /g,'+'); const json = decodeURIComponent(escape(atob(s))); return JSON.parse(json); }
  catch(e){ return null; }
}
function decodeSmart(s){
  try{ const j=LZString.decompressFromEncodedURIComponent(s); if(j){ return JSON.parse(j); } }catch(_){}
  const legacy=decodeLegacyBase64(s); if(legacy) return legacy;
  throw new Error("Could not decode data");
}

document.getElementById('btn-print').addEventListener('click', ()=>window.print());

let data;
try{
  const d = qs("d"); if(!d) throw new Error("Missing data");
  data = decodeSmart(d);
}catch(e){
  document.getElementById("app").innerHTML =
    '<div class="sheet"><h2>Invalid link</h2><p>The share link is missing or broken.</p><pre style="white-space:pre-wrap;color:#b91c1c">'+esc(String(e))+'</pre></div>';
  throw e;
}

const { projectName, brand, contact, roles, showHow } = data;

const cover = `
<section class="sheet"><div>
  <div style="display:flex;justify-content:space-between;align-items:flex-start;">
    <div style="display:flex;align-items:center;gap:12px">
      <div class="proj-title">${esc(projectName||"Presentation")}</div>
      ${brand?.logoUrl ? `<img src="${esc(brand.logoUrl)}" alt="Logo" style="height:36px;border-radius:8px;border:1px solid #eee">` : ``}
    </div>
    <div style="display:flex;align-items:center;gap:12px">
      ${brand?.showWordmark!==false ? `
        <div style="text-align:right">
          <div class="wordmark">${esc(brand?.wordmark||"SELFCAST")}</div>
          <div class="subtitle">${esc(brand?.subtitle||"CASTING MADE EASY")}</div>
        </div>` : ``}
    </div>
  </div>
  ${showHow!==false?`
  <div class="how" style="margin-top:18px">
    <h2>THIS IS HOW IT WORKS!</h2>
    <p><strong>Decline</strong><br>Click <em>Decline</em> to notify the Talent they’re not selected. They disappear from your list.</p>
    <p><strong><span class="green">Requested videos/photos</span></strong><br>See new videos or photos uploaded by the Talent for this job.</p>
    <p><strong>Talent picture</strong><br>Click a Talent’s picture to open their full profile.</p>
    <p><strong>Add to Shortlist</strong><br>Move Talents forward in the process, or book a Talent directly.</p>
    <div style="margin-top:10px;border-top:1px dashed var(--accent);padding-top:8px;color:#111">
      <div style="font-size:13px">If you need assistance:</div>
      <div style="color:#6b7280">${esc(contact?.person||"Selfcast")}${contact?.email?` · ${esc(contact.email)}`:""}${contact?.phone?` · ${esc(contact.phone)}`:""}</div>
    </div>
  </div>`:''}
</div></section>`;

const grid = `
<section class="sheet"><div>
  <div class="rolegrid">
    ${(roles||[]).map(r=>`
      <div class="rolecard">
        <div class="imgwrap">
          ${r.hero ? `<img src="${esc(r.hero)}" alt="${esc(r.title)}">` : `<div style="height:240px;background:#f4f4f5"></div>`}
          ${r.roleUrl ? `<a class="rolecta" href="${esc(r.roleUrl)}" target="_blank" rel="noreferrer">Open role</a>` : ``}
        </div>
        <div class="cap"><div style="font-weight:800">${esc(r.title||"")}</div></div>
      </div>
    `).join("")}
  </div>
</div></section>`;

document.getElementById("app").innerHTML = cover + grid;

// auto print if &print=1 (from builder)
if (new URLSearchParams(location.search).get("print")==="1") {
  setTimeout(()=>window.print(), 200);
}
</script>
</body>
</html>
