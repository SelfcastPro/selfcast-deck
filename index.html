<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Selfcast – Dashboard</title>
<style>
  :root{--bg:#0b0b0b;--fg:#f5f5f5;--accent:#e51c23;--line:#222}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .max{max-width:1000px;margin:0 auto;padding:24px}
  .top{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
  .btn{background:var(--accent);border:none;color:#fff;padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:700;text-decoration:none;display:inline-flex;align-items:center;gap:8px}
  .list{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px}
  .card{background:#121212;border:1px solid #222;border-radius:14px;padding:14px}
  .muted{color:#aaa;font-size:12px}
  .name{font-weight:800}
  .row{display:flex;justify-content:space-between;align-items:center;gap:8px}
  .ghost{background:transparent;border:1px solid #333;color:#fff}
  .danger{background:#3a0d0d;border:1px solid #5b1a1a}
</style>
</head>
<body>
  <div class="max">
    <div class="top">
      <div style="display:flex;align-items:center;gap:10px">
        <div style="width:36px;height:36px;border-radius:10px;background:var(--accent);display:grid;place-items:center;font-weight:900">S</div>
        <div>
          <div style="font-weight:900;letter-spacing:.18em">SELFCAST</div>
          <div class="muted" style="font-weight:700;letter-spacing:.06em">CASTING MADE EASY</div>
        </div>
      </div>
      <div style="display:flex;gap:8px">
        <a class="btn" href="/deckroles/">Open builder</a>
        <button id="logout" class="btn ghost">Logout</button>
      </div>
    </div>

    <h2 style="margin:0 0 12px">Projects</h2>
    <div id="list" class="list"></div>

    <div style="margin-top:16px">
      <a class="btn" href="/deckroles/">+ New project</a>
    </div>
  </div>

<script>
const KEY = "scDeckProjects";
const list = document.getElementById('list');
function load(){ try{return JSON.parse(localStorage.getItem(KEY)||"{}");}catch{return {};}}
function render(){
  const all = load();
  const names = Object.keys(all).sort();
  list.innerHTML = names.length ? names.map(n=>{
    const snapshot = all[n];
    const packed = btoa(unescape(encodeURIComponent(JSON.stringify(snapshot))));
    const viewUrl = `/view/?d=${packed}`;
    return `
      <div class="card">
        <div class="row">
          <div class="name">${n}</div>
          <a class="btn ghost" href="/deckroles/">Edit</a>
        </div>
        <div class="muted" style="margin:6px 0 10px">Updated locally</div>
        <div class="row">
          <a class="btn" href="${viewUrl}" target="_blank">Open read-only</a>
          <button class="btn danger" onclick="del('${n.replace(/'/g,"&#39;")}')">Delete</button>
        </div>
      </div>
    `;
  }).join('') : '<div class="muted">No projects yet. Click “+ New project”.</div>';
}
function del(name){
  if(!confirm(`Delete “${name}”?`)) return;
  const all = load(); delete all[name]; localStorage.setItem(KEY, JSON.stringify(all)); render();
}
document.getElementById('logout').onclick = async ()=>{
  await fetch('/api/logout'); location.href = '/login/';
};
render();
</script>
</body>
</html>
